import { __values } from '../../../node_modules/tslib/tslib.es6.js';
import { getVal, getValBoolean } from '../../../OpenXML.js';
import { parseTblCellSpacing, Tc } from './Tc.js';
import { parseTrHeight } from '../../../parse/parseTrHeight.js';
import { jcToTextAlign } from '../../../parse/jcToTextAlign.js';
import { Table } from '../Table.js';

var Tr = /** @class */ (function () {
    function Tr() {
        this.properties = {};
        this.tcs = [];
    }
    Tr.parseTrPr = function (word, element) {
        var e_1, _a;
        var cssStyle = {};
        var tcStyle = {};
        try {
            for (var _b = __values(element.children), _c = _b.next(); !_c.done; _c = _b.next()) {
                var child = _c.value;
                var tagName = child.tagName;
                switch (tagName) {
                    case 'w:hidden':
                        if (getValBoolean(child)) {
                            cssStyle.display = 'none';
                        }
                        break;
                    case 'w:trHeight':
                        parseTrHeight(child, cssStyle);
                        break;
                    case 'w:jc':
                        cssStyle['text-align'] = jcToTextAlign(getVal(child));
                        break;
                    case 'w:cantSplit':
                        // 目前也不支持分页
                        break;
                    case 'w:tblPrEx':
                        // http://webapp.docx4java.org/OnlineDemo/ecma376/WordML/tblPrEx_1.html
                        var tablePr = Table.parseTablePr(word, child);
                        Object.assign(cssStyle, tablePr.cssStyle);
                        break;
                    case 'w:tblCellSpacing':
                        parseTblCellSpacing(child, tcStyle);
                        break;
                    case 'w:cnfStyle':
                        // 目前是自动计算的，所以不需要这个了
                        break;
                    default:
                        console.warn("Tr: Unknown tag ", tagName, child);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return {
            cssStyle: cssStyle
        };
    };
    Tr.fromXML = function (word, element, rowSpanMap) {
        var e_2, _a;
        var tr = new Tr();
        // 做成对象是为了传递引用来修改
        var currentCol = {
            index: 0
        };
        try {
            for (var _b = __values(element.children), _c = _b.next(); !_c.done; _c = _b.next()) {
                var child = _c.value;
                var tagName = child.tagName;
                switch (tagName) {
                    case 'w:tc':
                        var tc = Tc.fromXML(word, child, currentCol, rowSpanMap);
                        if (tc) {
                            tr.tcs.push(tc);
                        }
                        break;
                    case 'w:trPr':
                        tr.properties = Tr.parseTrPr(word, child);
                        break;
                    case 'w:tblPrEx':
                        // http://webapp.docx4java.org/OnlineDemo/ecma376/WordML/tblPrEx_1.html
                        var tablePr = Table.parseTablePr(word, child);
                        Object.assign(tr.properties.cssStyle || {}, tablePr.cssStyle);
                        break;
                    default:
                        console.warn("Tr: Unknown tag ", tagName, child);
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return tr;
    };
    return Tr;
}());

export { Tr };
