/**
 * amis-ui v2.9.0
 * Copyright 2018-2023 fex
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var tslib = require('tslib');
var React = require('react');
var amisCore = require('amis-core');
var PopOverContainer = require('../PopOverContainer.js');
var GroupedSelection = require('../GroupedSelection.js');
var ResultBox = require('../ResultBox.js');
var icons = require('../icons.js');
var Expression = require('./Expression.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);

var option2value = function (item) { return item.type; };
var ConditionFunc = /** @class */ (function (_super) {
    tslib.__extends(ConditionFunc, _super);
    function ConditionFunc() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ConditionFunc.prototype.handleFuncChange = function (type) {
        var value = tslib.__assign({}, this.props.value);
        value.func = type;
        this.props.onChange(value);
    };
    ConditionFunc.prototype.handleArgChange = function (arg, index) {
        var value = tslib.__assign({}, this.props.value);
        value.args = Array.isArray(value.args) ? value.args.concat() : [];
        value.args.splice(index, 1, arg);
        this.props.onChange(value);
    };
    ConditionFunc.prototype.renderFunc = function (func) {
        var _this = this;
        var _a = this.props, cx = _a.classnames, fields = _a.fields, value = _a.value, funcs = _a.funcs, config = _a.config, disabled = _a.disabled;
        return (React__default["default"].createElement("div", { className: cx('CBFunc-args') },
            React__default["default"].createElement("span", null, "("),
            Array.isArray(func.args) && func.args.length ? (React__default["default"].createElement("div", null, func.args.map(function (item, index) { return (React__default["default"].createElement(Expression["default"], { config: config, key: index, index: index, fields: fields, value: value === null || value === void 0 ? void 0 : value.args[index], valueField: { type: item.type }, onChange: _this.handleArgChange, funcs: funcs, disabled: disabled })); }))) : null,
            React__default["default"].createElement("span", null, ")")));
    };
    ConditionFunc.prototype.render = function () {
        var _this = this;
        var _a = this.props, value = _a.value, cx = _a.classnames, fieldClassName = _a.fieldClassName, funcs = _a.funcs, disabled = _a.disabled, __ = _a.translate;
        var func = value
            ? amisCore.findTree(funcs, function (item) { return item.type === value.func; })
            : null;
        return (React__default["default"].createElement("div", { className: cx('CBFunc') },
            React__default["default"].createElement(PopOverContainer.PopOverContainer, { popOverRender: function (_a) {
                    var onClose = _a.onClose;
                    return (React__default["default"].createElement(GroupedSelection["default"], { onClick: onClose, options: funcs, value: func === null || func === void 0 ? void 0 : func.type, option2value: option2value, onChange: _this.handleFuncChange, multiple: false }));
                } }, function (_a) {
                var onClick = _a.onClick, ref = _a.ref, isOpened = _a.isOpened;
                return (React__default["default"].createElement("div", { className: cx('CBFunc-select') },
                    React__default["default"].createElement(ResultBox["default"], { className: cx('CBGroup-fieldInput', fieldClassName, isOpened ? 'is-active' : ''), ref: ref, allowInput: false, result: func, onResultChange: amisCore.noop, onResultClick: onClick, placeholder: __('Condition.field_placeholder'), disabled: disabled },
                        React__default["default"].createElement("span", { className: cx('CBGroup-fieldCaret') },
                            React__default["default"].createElement(icons.Icon, { icon: "caret", className: "icon" })))));
            }),
            func ? (this.renderFunc(func)) : (React__default["default"].createElement("span", { className: cx('CBFunc-error') }, __('Condition.fun_error')))));
    };
    tslib.__decorate([
        amisCore.autobind,
        tslib.__metadata("design:type", Function),
        tslib.__metadata("design:paramtypes", [String]),
        tslib.__metadata("design:returntype", void 0)
    ], ConditionFunc.prototype, "handleFuncChange", null);
    tslib.__decorate([
        amisCore.autobind,
        tslib.__metadata("design:type", Function),
        tslib.__metadata("design:paramtypes", [Object, Number]),
        tslib.__metadata("design:returntype", void 0)
    ], ConditionFunc.prototype, "handleArgChange", null);
    return ConditionFunc;
}(React__default["default"].Component));
var ConditionFunc$1 = amisCore.themeable(amisCore.localeable(ConditionFunc));

exports.ConditionFunc = ConditionFunc;
exports["default"] = ConditionFunc$1;
